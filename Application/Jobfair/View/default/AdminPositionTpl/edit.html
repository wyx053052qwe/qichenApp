<include file="Admin@default/public/header" />
<link href="../public/css/admin_jobfair.css" rel="stylesheet" type="text/css" />
<div class="toptit">批量添加展位</div>
<div class="form_main width120">
    <form action="{:U('position_add')}" method="post">
        <div class="area_tpl">
            <div class="fl">展区编号:</div>
            <div class="fr txt">
                <select name="area[]" style="width: 100px;">
                    <volist name="pre" id="vo">
                        <option value="{$vo}">&nbsp;{$vo}&nbsp;</option>
                    </volist>
                </select>
            </div>
            <div class="fl">展位号:</div>
            <div class="fr">
                <input name="position_start[]" type="text" class="input_text_default small" value="" style="width: 50px;">&nbsp;&nbsp;至&nbsp;&nbsp;
                <input name="position_end[]" type="text" class="input_text_default small" value="" style="width: 50px;">
                <label class="no-fl-note">(如填写“1-10”,系统将自动生成10个展位,并且编号由1开始、由10结束)</label>
            </div>
            <div style="width: 660px; height: 20px; border-top: 1px #DFDFDF dashed; margin-left: 60px; float: left; margin-top: 10px">&nbsp;</div>
        </div>
        <div class="continue_add"></div>
        <div class="fl"></div>
        <div class="fr">
            <input type="hidden" name="id" value="{$info['id']}">
            <input type="submit" class="admin_submit" value="保存"/>
            <input type="button" class="admin_submit" id="add_more" value="继续添加"/>
        </div>
        <div class="clear"></div>
    </form>
</div>

<div class="toptit">批量删除展位</div>
<div class="form_main width120">
    <form action="{:U('position_delete_batch')}" method="post">
        <div class="fl">展区编号:</div>
        <div class="fr txt">
            <select name="area" style="width: 100px;">
                <volist name="pre" id="vo">
                    <option value="{$vo}">&nbsp;{$vo}&nbsp;</option>
                </volist>
            </select>
        </div>
        <div class="fl">展位号:</div>
        <div class="fr">
            <input name="position_start" type="text" class="input_text_default small" value="" style="width: 50px;">&nbsp;&nbsp;至&nbsp;&nbsp;
            <input name="position_end" type="text" class="input_text_default small" value="" style="width: 50px;">
            <label class="no-fl-note">(如填写“1-10”,系统将删除编号由1开始、由10结束的10个展位)</label>
        </div>
        <div class="fl"></div>
        <div class="fr">
            <input type="hidden" name="id" value="{$info['id']}">
            <input type="submit" class="admin_submit" value="删除" onclick="javascript:return confirm('确定要删除吗？');"/>
        </div>
        <div class="clear"></div>
    </form>
</div>

<if condition="$info['area']">
    <div class="toptit">删除展区</div>
    <div class="form_main width120">
        <form action="{:U('area_delete')}" method="post">
            <div class="fl">展区编号:</div>
            <div class="fr txt">
                <select name="area" style="width: 100px;">
                    <volist name="info['area']" id="vo">
                        <option value="{$vo['id']}">&nbsp;{$vo['area']}&nbsp;</option>
                    </volist>
                </select>
            </div>
            <div class="fl"></div>
            <div class="fr">
                <input type="hidden" name="id" value="{$info['id']}">
                <input type="submit" class="admin_submit" value="删除" onclick="javascript:return confirm('删除展区将同时删除该展区的展位及预订数据，确定删除吗？');"/>
            </div>
            <div class="clear"></div>
        </form>
    </div>
</if>

<div class="toptit">展位图</div>
<div class="form_main">
    <form id="img_form" action="{:U('upload_position_img')}" method="post" enctype="multipart/form-data">
        <notempty name="info['position_img']">
            <volist name="info['position_img']" id="vo">
                <div style="float:left; text-align:center; padding:15px; line-height:180%;margin-left: 30px; margin-bottom: 20px; background-color:#E4F4FC"  class="link_blue img_list">
                    <a href="{:attach($vo,'jobfair_tpl')}" target="_blank">
                        <img src="{:attach($vo,'jobfair_tpl')}" width="180" height="130" border="1" style="border: #CCCCCC;"/>
                    </a>
                    <br />
                    <a href="javascript:;" class="delete_img" params="id={$info['id']}&img={$vo}">删除</a>
                </div>
            </volist>
            <div class="clear"></div>
        </notempty>
        <div class="fl" style=" width: 45px;">&nbsp;</div>
        <div class="fr">
            <input type="button" value="添加展位图" class="admin_submit img_add"/>
            <input type="file" class="hidden_file" id="hidden_file" name="img" style="display:none;">
            <input type="hidden" name="id" value="{$info['id']}">
        </div>
        <div class="clear"></div>
    </form>
</div>

<div class="toptit">展位情况一览<span style="color: #999999; font-size: 13px;">（鼠标点击可删除展区）</span></div>
<div class="form_main jobfair_position">
    <div class="area">
        <ul>
            <volist name="info['area']" id="vo">
                <li <if condition="$i eq 1">class="select"</if> area_id="{$vo}">{$vo}区</li>
            </volist>
            <div class="clear"></div>
        </ul>
    </div>
    <volist name="info['area']" id="vo">
        <div class="booth" id="area_wrap_{$vo}" <if condition="$i neq 1">style="display:none;"</if>>
        <volist name="info['position'][$vo]" id="v">
            <div class="li delete" title="点击删除" position_id="{$v}" area="{$vo}" tpl_id="{$info['id']}">{$v}</div>
        </volist>
        <div class="clear"></div>
        </div>
    </volist>
</div>

</div>
<include file="Admin@default/public/footer" />
</body>
<script type="text/javascript">
    $(document).ready(function () {
        // 继续添加
        $("#add_more").click(function()
        {
            $(".continue_add").append($(".area_tpl").html());
        });
        // 上传图片
        $('.img_add').click(function(){
            $("#hidden_file").click();
        });
        $("#hidden_file").change(function(){
            $("#img_form").submit();
        });
        // 删除图片
        $(".delete_img").click(function(){
            if(confirm('确定删除该展位图吗？')){
                var params = $(this).attr('params');
                location.href="{:U('position_img_delete')}?"+params;
            }
        });

        $(".booth .li").hover(function(){
            $(this).children('.tip').toggle();
        });
        $(".area li").click(function(){
            $(this).addClass('select').siblings().removeClass('select');
            var area_id = $(this).attr('area_id');
            $(".booth").hide();
            $("#area_wrap_"+area_id).show();
        });
        $(".delete").live('click',function(){
            if(confirm('确定删除该展位吗？')){
                var area = $(this).attr('area');
                var tpl_id = $(this).attr('tpl_id');
                var position = $(this).attr('position_id');
                var thisObj = $(this);
                $.getJSON("{:U('position_delete')}",{position:position,area:area,id:tpl_id},function(result){
                    if(result.status==1){
                        thisObj.closest('.li').remove();
                    }
                    alert(result.msg);
                });
            }
        });
    });
</script>
</html>