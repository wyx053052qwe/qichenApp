<!DOCTYPE html>
<html>
	<head>
    <link rel="stylesheet" type="text/css" href="../public_qichen/css/style.css">
		<include file="public:meta" />
		<link rel="stylesheet" href="../public/css/personal.css">
	</head>
	<body>
  <include file="public:header"/>
  <div class="replenishtop  " >
      <div class="rename"></div>
      <div class="integrity">完整度：<span>{$resume.complete_percent}%</span></div>
      <div class="integritys">简历状态：<div class="rg_privacy J_privacy_btn <if condition="$resume['display'] eq 0">close</if>" data-id="{$resume.id}"></div></div>
    </div>
    <div class="replenishtopbg"></div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t1">
        基本资料<span class="font12">(必填)</span>
        <div class="editbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_basis',array('pid'=>$resume['id']))}'">修改</div>
      </div>
      <div class="picmod">
        <div class="pic">
          <div class="picborder">
            <img src="{$visitor.avatars}">
          </div>
        </div>
        <div class="rneme">
          <div class="t font16">{$resume.fullname}</div>
          <div class="txt">{$resume.sex_cn}&nbsp;|&nbsp;{:date('Y')-$resume['birthdate']}岁&nbsp;|&nbsp;{$resume.marriage_cn}<if condition="$resume['height']">&nbsp;|&nbsp;{$resume.height}cm</if></div>
        </div>
        <div class="clear"></div>
      </div>
      <div class="txt2list">
        <div class="tleft">最高学历</div>
        <div class="tright">{$resume.education_cn}</div>
        <div class="clear"></div>
        <div class="tleft">工作经验</div>
        <div class="tright">{$resume.experience_cn}</div>
        <div class="clear"></div>
        <div class="tleft">专业</div>
        <div class="tright"><if condition="$resume['major_cn']">{$resume.major_cn}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">现居住地</div>
        <div class="tright"><if condition="$resume['residence']">{$resume.residence}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">籍贯</div>
        <div class="tright"><if condition="$resume['householdaddress']">{$resume.householdaddress}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">手机</div>
        <div class="tright"><if condition="$resume['telephone']">{$resume.telephone}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">邮箱</div>
        <div class="tright"><if condition="$resume['email']">{$resume.email}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">QQ</div>
        <div class="tright"><if condition="$resume['qq']">{$resume.qq}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">微信号</div>
        <div class="tright"><if condition="$resume['weixin']">{$resume.weixin}<else/>未填写</if></div>
        <div class="clear"></div>
        <div class="tleft">身份证号</div>
        <div class="tright"><if condition="$resume['idcard']">{$resume.idcard}<else/>未填写</if></div>
        <div class="clear"></div>
      </div>
    </div>
    <div class="split-block"></div>	 
    <div class="listmod">
      <div class="eattitle list_height t2">
      求职意向<span class="font12">(必填)</span>
        <div class="editbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_intent',array('pid'=>$resume['id']))}'">修改</div>
      </div>
      <div class="txt2list">
        <div class="tleft">求职状态</div>
    	<div class="tright">{$resume.current_cn}</div>
        <div class="clear"></div>
    	  <div class="tleft">工作性质</div>
    	<div class="tright">{$resume.nature_cn}</div>
        <div class="clear"></div>
    	  <div class="tleft">期望薪资</div>
    	<div class="tright">{$resume.wage_cn}</div>
        <div class="clear"></div>
    	  <div class="tleft">期望行业</div>
    	<div class="tright"><if condition="$resume['trade_cn']">{$resume.trade_cn}<else/>不限</if></div>
        <div class="clear"></div>
    	  <div class="tleft">期望职位</div>
    	<div class="tright"><if condition="$resume['intention_jobs']">{$resume.intention_jobs}<else/>未填写</if></div>
        <div class="clear"></div>
    	  <div class="tleft">工作地区</div>
    	<div class="tright"><if condition="$resume['district_cn']">{$resume.district_cn}<else/>未填写</if></div>
        <div class="clear"></div>
      </div>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t3">
        自我描述
        <div class="editbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_description',array('pid'=>$resume['id']))}'">修改</div>
      </div>
        <if condition="$resume['specialty']"><div class="txtmod">{$resume.specialty}</div></if>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t4">
      教育经历
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_edu',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <div id="J_education"></div>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t5">
      工作经历
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_work',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <div id="J_work"></div>
    </div>
    <div class="split-block"></div>
      <div class="listmod">
        <div class="eattitle list_height t6">
        培训经历
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_train',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <div id="J_training"></div>
    </div>
    <div class="split-block"></div>
      <div class="listmod">
        <div class="eattitle list_height t11">
        项目经历
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_project',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <div id="J_project"></div>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t7">
      获得证书
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_certificate',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <div id="J_credent"></div>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t8">
      语言能力
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_lang',array('pid'=>$resume['id']))}'">新增</div>
      </div>
       <div id="J_language"></div>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t9">
        特长标签
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_speciality',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <if condition="$resume['tag_cn']">
      <div id="J_tags" class="tagmod" pid="{$resume.id}">
        <volist name="resume['tag_key']" id="tag">
          <div class="J_tagList litag substring" <if condition="$tags[$tag]">tid="{$tag}"<else/>title="{$tag}"</if>>
            {$tags[$tag]}
            <div class="del"></div>
          </div>
        </volist>
        <volist name="resume['tag_cn']" id="tag">
          <if condition="!in_array($tag,$tags)">
            <div class="J_tagList litag substring" title="{$tag}">{$tag}<div class="del"></div></div>
          </if>
        </volist>
        <div class="clear"></div>
      </div>
      </if>
    </div>
    <div class="split-block"></div>
    <div class="listmod">
      <div class="eattitle list_height t10">
        照片/作品
        <div class="addbtn font13" onClick="javascript:location.href='{:U('personal/resume_edit_img',array('pid'=>$resume['id']))}'">新增</div>
      </div>
      <volist name="resume_img" id="img">
        <div class="imgmod" iid="{$img.id}"  type="img" pid="{$resume['id']}" sid="{$img['id']}">
          <div class="expedit" onClick="javascript:location.href='{:U('personal/resume_edit_img',array('pid'=>$resume['id'],'id'=>$img['id']))}'"></div>
          <div class="J_delete expdel"></div>
          <div class="imgtd1"><img src="{:attach($img['img'],'resume_img')}"></div>
          <div class="imgtd2">
            <div class="iname"><if condition="$img['title']">{$img.title}<else/>未填写备注</if></div>
            <switch name="img['audit']">
              <case value="1">
                <span class="font_green">审核通过</span>
              </case>
              <case value="2">
                <span class="font_yellow">审核中</span>
              </case>
              <case value="3">
                <span class="font_red">审核未通过</span>
              </case>
            </switch>
          </div>
          <div class="clear"></div>
        </div>
      </volist>
    </div>

    <div class="btns-div">
        <div class="btnli"><div  class="qs-btn qs-btn-orange font18" onClick="javascript:location.href='{:U('personal/index')}'">保存简历</div></div>
        <div class="btnli"><div class="qs-btn qs-btn-border-blue font18" onClick="javascript:location.href='{:url_rewrite('QS_resumeshow',array('id'=>$resume['id']))}'">预览简历</div></div>
        <div class="clear"></div>
    </div>

    <div class="shabi" style="height:50px"></div>

    <include file="public_qichen:footer_geren_2" />
     <script src="../public/js/fastclick.js"></script>
<script>
    window.addEventListener( "load", function() {
        FastClick.attach(document.body);
    }, false );
</script>
<script src="../public/js/QSpopout.js"></script>
<script src="../public/js/QSfilter.js"></script>
<script src="../public/js/zepto.hwSlider.js"></script>
<script src="../public/js/scrollTo.js"></script>
<script src="../public/js/RongIMLib-2.2.8.min.js"></script>
<script src="../public/js/qs.action.js"></script>
<script src="../public/js/qs.select.js"></script>
<script src="../public/js/dialog.js"></script>
<script src="https://static.geetest.com/static/tools/gt.js"></script>
<if condition="$rong_state eq 1">
<script src="../public/js/rong_main.js"></script>
</if>
<script>
    if (!$('.foot_pub_box_list li').length) {
        $('#JFootPub').remove();
        $('.fix-footNav').addClass('n4');
    }
    // 锁定屏幕
    function lockTouchMove(){
        //document.body.addEventListener('touchmove', handler, { passive: false })
        $("body").bind("touchmove",function(event){event.preventDefault()});
    }

    // 解锁屏幕
    function unLockTouchMove(){
        //document.body.removeEventListener('touchmove', handler, { passive: false })
        $("body").unbind("touchmove");
    }
    // 服务
    function closeFootPub() {
        $('.JFootPubNav').removeClass('slideInUp animated').addClass('slideOutDown animated'); unLockTouchMove();
    }
    $('#JFootPub').off().on('click', function() {
        lockTouchMove();
        $('.JFootPubNav').removeClass('slideOutDown animated').addClass('slideInUp animated');
        // 关闭
        $('#JFootPubClose').off().on('click', function() { closeFootPub(); });
    });
    $('a[href]').click(function() {
        var f = $(this).attr('href');
        var reg = /\#(\w+)/;
        if (reg.test(f)) {
            if (!$(this).data('nm')) {
                return !1;
            }
        }
    });
    $(".js-back").on('click',function(){
        /*if (history.length == 1){
            window.location.href = '{:U("index/index")}';
        } else {
            history.back();
        }*/
        history.back();
    });
    /**
     * 监听鼠标
     */
    if ('ontouchstart' in window) {
        $.EVENT_START = 'touchstart';
        $.EVENT_END = 'touchend';
    } else {
        $.EVENT_START = 'mousedown';
        $.EVENT_END = 'mouseup';
    }
    $('.plist-txt, .qs-btn, .for-event').on($.EVENT_START, function() {
        $(this).addClass('eventactive');
        /*if($(this).find('input[type="text"]').length) {
            $(this).find('input[type="text"]').focus();
        }*/
    });
    $('.plist-txt, .qs-btn, .for-event').on($.EVENT_END, function() {
        $(this).removeClass('eventactive');
    });
    $('.plist-txt, .qs-btn, .for-event').on('touchcancel', function() {
        $(this).removeClass('eventactive');
    });
    $('.logout').on('click', function() {
        forCloseNav();
        $(document).dialog({
            type: 'confirm',
            content: '确定退出吗？',
            onClickConfirmBtn: function() {
                window.location.href = "{:U('Members/logout')}";
            }
        });
    });
    /**
     * 返回顶部
     */
    var global = {
        h: $(window).height(),
        st: $(window).scrollTop(),
        backTop: function() {
            global.st > (global.h * 0.5) ? $("#backtop").show() : $("#backtop").hide();
        }
    };
    /**
     * Notice 提醒公用方法
     * @param infoText 提示文字
     */
    function qsNotice(infoText) {
        $(document).dialog({
            type : 'notice',
            infoText: infoText,
            autoClose: 1500,
            position: 'center',
            dialogClass: 'dialog_toast'
        });
    }
    // 定义Toast图片路径
    var loadingImg = '../public/images/dialog/loading.gif',
        successImg = '../public/images/dialog/success.png',
        failImg = '../public/images/dialog/fail.png',
        warningImg = '../public/images/dialog/warning.png';
    /**
     * 正在加载中
     * @param infoText 内容
     */
    function qsToasting() {
        var infoContent = arguments[0] ? arguments[0] : '';
        var closeTime = arguments[1] === 0 ? arguments[1] : 1500;
        var $cuToasting = $(document).dialog({
            type : 'toast',
            infoIcon: loadingImg,
            infoText: infoContent,
            autoClose: closeTime
        });
        return $cuToasting;
    }
    /**
     * Toast 类型通知 用于需要反馈结果
     * @param msg 反馈内容
     * @param type 反馈类型 可以不传参数有默认值 0->失败 1->成功
     * @param obj 正在加载对象 用于更新Toast
     */
    function qsToast(msg, type, obj) {
        type = arguments[1] ? arguments[1] : 2;
        var icons = [failImg, successImg, warningImg];
        var setting = {
            type : 'toast',
            infoText: msg,
            infoIcon: icons[type],
            autoClose: 1500,
            dialogClass: 'dialog_toast'
        };
        if (obj){
            obj.update(setting);
        } else {
            return $(document).dialog(setting);
        }
    }
    // 锁定屏幕
    function lock_touchmove(){
        $("body").bind("touchmove",function(event){event.preventDefault();});
    }
    // 解锁屏幕
    function un_lock_touchmove(){
        $("body").unbind("touchmove");
    }
    // 弹出框登录
    function logDialog() {
        // 是否需要刷新页面
        var isRefresh = arguments[0] === 0 ? arguments[0] : 1;
        // 页面跳转链接
        var urlValue = arguments[1] ? arguments[1] : '';
        if(qscms.is_login > 0 && urlValue){
            window.location.href = urlValue;
            return !1;
        }
        var utype = arguments[2] ? arguments[2] : 0;
        // 正在加载
        var $logLoad = qsToasting('', 0);
        var loginUrl = "{:U('AjaxCommon/ajax_login')}";
        $.getJSON(loginUrl, {refresh: isRefresh, url: urlValue, utype:utype}, function(result){
            $logLoad.close();
            if(result.status==1){
                var $logPop = new QSpopout('亲，验证一下手机吧');
                $logPop.setContent(result.data);
                $('.qs-popout-ft').remove();
                $('.qs-popout-bd').addClass('no-pd');
                $logPop.show();
                // 关闭
                $('.closePopout').on('click', function() {
                    $('#popout').fadeOut(200);
                    $('#popout').remove();
                });
            } else {
                qsToast(result.msg, '', '');
            }
        });
    }
    // 如果文档高度不大于窗口高度，数据较少，删除页面中的无数据提醒
    function removeDropLoadDown() {
        var doc = document;
        var $doc = $(doc);
        var $dropDownEle = $('.dropload-down');
        var scrollContentHeight = $doc.height();
        var scrollWindowHeight = doc.documentElement.clientHeight;
        var threshold = Math.floor($dropDownEle.height()*1/3);
        if((scrollContentHeight - threshold) <= scrollWindowHeight){
            $dropDownEle.remove();
        }
    }
    //判断是不是iPhoneX，适配iPhoneX底部遮挡问题
    if (funJudgeX()) {
        $('.fix-footNav').addClass('iPhoneX');
        $('body').addClass('iPhoneX');
    }
</script>
<div class="qs-hidden">{:htmlspecialchars_decode(C('qscms_statistics'))}</div>
    <script src="../public/js/popWin.js"></script>
    <script src="../public/js/qsCategory.js"></script>
    <script id="J_describeTemp" type="text/html">
      <div class="headernavfixed">
          <div class="headernav font18"><div class="title">简历标题<div class="return js-back"></div></div></div>
      </div>
      <div class="split-block"></div>
      <div class="list_height plist-txt notarrow">
          <div class="pic"></div>
          <div class="tit font14">简历标题</div>
          <div class="describe font12">
              <input type="text" id="tpl_title" value="{$resume.title}" class="font13">
          </div>
          <div class="arrow"></div>
          <div class="clear"></div>
      </div>
      <div class="split-block"></div>
      <div class="btn-spacing">
          <div id="titleBtn" class="qs-btn qs-btn-blue font18" title="确定">确定</div>
      </div>
    </script>
    <script type="text/javascript">
        // 异步加载简历内容
        $('#J_education').load("{:U('personal/ajax_get_education_list',array('pid'=>$resume['id']))}");
        $('#J_work').load("{:U('personal/ajax_get_work_list',array('pid'=>$resume['id']))}");
        $('#J_training').load("{:U('personal/ajax_get_training_list',array('pid'=>$resume['id']))}");
        $('#J_credent').load("{:U('personal/ajax_get_credent_list',array('pid'=>$resume['id']))}");
        $('#J_language').load("{:U('personal/ajax_get_language_list',array('pid'=>$resume['id']))}");
        $('#J_project').load("{:U('personal/ajax_get_project_list',array('pid'=>$resume['id']))}");
        // 简历状态开关
        $('.J_privacy_btn').live('click', function() {
            var f = $(this).parent(),
                pid = $(this).data('id');
            if ($(this).hasClass('close')) {
                $(document).dialog({
                    type : 'confirm',
                    titleText: '简历显示',
                    content: '简历显示后将在列表页显示以及被搜索，确定显示吗?',
                    onClickConfirmBtn: function(){
                        $.post(qscms.root + '?m=Mobile&c=Personal&a=save_resume_privacy', {
                            pid: pid,
                            display: 1
                        }, function(result) {
                            if (result.status == 1) {
                                f.remove();
                                qsToast(result.msg);
                                setTimeout(function() {
                                    window.location.reload();
                                }, 0);
                            } else {
                                qsToast(result.msg);
                            }
                        }, 'json');
                    }
                });
            } else {
                $(document).dialog({
                    type : 'confirm',
                    titleText: '简历关闭',
                    content: '简历关闭后将不能显示以及被搜索，确定关闭吗?',
                    onClickConfirmBtn: function(){
                        $.post(qscms.root + '?m=Mobile&c=Personal&a=save_resume_privacy', {
                            pid: pid,
                            display: 0
                        }, function(result) {
                            if (result.status == 1) {
                                f.remove();
                                qsToast(result.msg);
                                setTimeout(function() {
                                    window.location.reload();
                                }, 0);
                            } else {
                                qsToast(result.msg);
                            }
                        }, 'json');
                    }
                });
            }
        });
        // 定义提示标题
        var tip = {
            education: '教育经历',
            language: '语言能力',
            training: '培训经历',
            project: '项目经历',
            work: '工作经历',
            credent: '证书',
            img: '照片/作品'
        };
        // 删除
        $('.J_delete').live('click', function() {
            var f = $(this).parent(),
                type = $(this).parent().attr('type'),
                pid = $(this).parent().attr('pid'),
                id = $(this).parent().attr('sid');
            $(document).dialog({
                type : 'confirm',
                titleText: '删除' + tip[type],
                content: '删除后将无法恢复，您确定要删除该' + tip[type] + '吗?',
                onClickConfirmBtn: function(){
                    var cuToast = qsToasting('正在删除');
                    $.post(qscms.root + '?m=Mobile&c=Personal&a=del_' + type, {
                        pid: pid,
                        id: id
                    }, function(result) {
                        if (result.status == 1) {
                            f.remove();
                            qsToast(result.msg, 1, cuToast);
                        } else {
                            qsToast(result.msg, 0, cuToast);
                        }
                    }, 'json');
                }
            });
        });
        // 特长标签删除
        $('#J_tags .del').live('click', function() {
            var pid = $(this).closest('#J_tags').attr('pid');
            $(this).parent().remove();
            var tag = $('#J_tags .J_tagList[tid]').map(function() {
                return $(this).attr('tid');
            }).get();
            var tag_cn = $('#J_tags .J_tagList[title]').not('[tid]').map(function() {
                return $(this).attr('title');
            }).get();
            if ($('.J_tagList').length == 0) {
                $('#J_tags').remove();
            }
            var cuToast = qsToasting('正在删除');
            $.post("{:U('Personal/resume_edit_speciality')}", {
                pid: pid,
                tag: tag,
                tag_cn: tag_cn
            }, function(result) {
                if (result.status == 1) {
                    qsToast('特长标签删除成功', 1, cuToast);
                } else {
                    qsToast(data.msg, 0, cuToast);
                }
            }, 'json');
        });
        var describeTemp = $('#J_describeTemp').html();
        $('.J_titleEdit').on('click', function() {
            var $this = $(this),
                baseTxt = $this.text();
            popWin.init({
                from: "right",
                html: describeTemp,
                handle: function(a) {
                    $('#tpl_title').val($('#J_title').html());
                    $('#titleBtn').on('click', function() {
                        var title = $('#tpl_title').val();
                        if (title == "") {
                            qsToast('请填写简历标题');
                            return false;
                        }
                        if (title != "" && title.length > 12) {
                            qsToast('简历标题应在1~12个字内');
                            return false;
                        }
                        var pid = "{$resume.id}";
                        $.post("{:U('Personal/resume_edit_title')}", {
                            pid: pid,
                            title: title
                        }, function(result) {
                            if (result.status == 1) {
                                $('#J_title').html(title);
                                qsToast(result.msg);
                            } else {
                                qsToast(result.msg);
                            }
                            a.close();
                        }, 'json');
                    });
                }
            })
        });

        function check_complete_percent_allowance() {
            if (eval("{:C('qscms_perfected_resume_allowance_open')}") == 1) {
                $.getJSON("{:U('Personal/check_complete_percent_allowance')}", function(result) {
                    if (result.status == 1) {
                        $(document).dialog({
                            titleShow: false,
                            content: result.msg,
                            buttons: [
                                {
                                    name: '确定',
                                    callback: function() {}
                                }
                            ]
                        });
                    } else if (result.status == 2) {
                        $(document).dialog({
                            titleShow: false,
                            content: result.msg,
                            buttons: [
                                {
                                    name: '关闭',
                                    callback: function() {}
                                },
                                {
                                    name: '不再提示',
                                    callback: function() {
                                        $.getJSON("{:U('Personal/check_complete_percent_allowance_nolonger_notice')}");
                                    }
                                }
                            ]
                        });
                    }
                });
            }
        }
        $(document).ready(function() {
            check_complete_percent_allowance();
        });
    </script>
	</body>
</html>